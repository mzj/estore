<?php

namespace eStore\ShopBundle\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * CategoryRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
use Gedmo\Tree\Entity\Repository\NestedTreeRepository;
        
class CategoryRepository extends NestedTreeRepository
{
    public function categoryMenu($helper) 
    {
       
        return $this->childrenHierarchy(null, false, array('decorate' => true, 'nodeDecorator' => 
            function($node) use ($helper) {
                return '<a href="' . $helper->generateUrl('eStoreShopBundle_categories', array('id' => $node['id'],'slug' => $node['slug'])) . '">' 
                        . $node['name'] . '</a>';
            })
        );
    }
    
    public function categoryMenuArray() {
        
        return $this->childrenHierarchy(null, false);
    }
    
    /**
     * @todo Find more eficiant and right way to get all products
     */
    public function getAllProducts($category) 
    {
        $categories =  $this->children($category, false);
        $categories[] = $category;
        $products = array();
        
        foreach($categories as $category) {
           $titles[] = $category->getName();
           
           foreach($category->getProducts() as $product) {
               $products[] = $product;
           }
        }
        
        return $products;
       
    }    
}